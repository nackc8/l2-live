#!/bin/bash

SCRIPT_DIR="$(dirname -- $0)"

OVMF_CODE=/usr/share/OVMF/OVMF_CODE_4M.fd

# Copied from /usr/share/OVMF/OVMF_VARS_4M.fd
OVMF_VARS="$SCRIPT_DIR/OVMF_VARS_4M.fd"

ISO="$SCRIPT_DIR/tiny.iso"

qemu-system-x86_64 \
	-boot d \
	-cdrom "$ISO" \
	-daemonize \
	-device usb-ehci \
	-device usb-tablet \
	-device virtio-gpu-pci \
	-drive file=arch-disk1.qcow2,format=qcow2 \
	-drive file=arch-disk2.qcow2,format=qcow2 \
	-drive if=pflash,format=raw,file="$OVMF_VARS" \
	-drive if=pflash,format=raw,readonly=on,file="$OVMF_CODE" \
	-enable-kvm \
	-m 4G \
	-machine q35 \
	-smp 2
